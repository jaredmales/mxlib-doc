<!-- HTML header for doxygen 1.9.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>mxlib: Installation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<!-- ... other metadata & script includes ... -->
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
</script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">mxlib
   </div>
   <div id="projectbrief">c++ tools for analyzing astronomical data and other tasks by Jared R. Males. [<a href="https://github.com/jaredmales/mxlib">git repo</a>]</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('group__installation.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">Installation</div></div>
</div><!--header-->
<div class="contents">
<h1><a class="anchor" id="install_intro"></a>
Introduction</h1>
<p>These are instructions for installing the <code>mxlib</code> c/c++ library. This is my personal library which I have built up over many years. Along the way I have tried to keep it organized and documented. I have installed it on several different linux systems (running Rocky or Ubuntu). Installation on Mac O/S is also possible using Conda.</p>
<p>The below instructions were updated in July 2025 after implementing the CMake build system. The original <code>make</code> build system still works (July, 2025) but will not be maintained going forward.</p>
<h1><a class="anchor" id="quick_start"></a>
Quick Start</h1>
<p>Assuming you have all the dependencies met, the recipe for installing <code>mxlib</code> with <code>cmake</code> is:</p>
<div class="fragment"><div class="line">git clone https://github.com/jaredmales/mxlib.git</div>
<div class="line">cd mxlib</div>
<div class="line">mkdir _build</div>
<div class="line">cd _build</div>
<div class="line">cmake ..</div>
<div class="line">make</div>
<div class="line">sudo -E make install</div>
</div><!-- fragment --><h1><a class="anchor" id="dependencies"></a>
Installing Dependencies</h1>
<p>The libraries that <code>mxlib</code> depends on are easy to install from either source or using your O/S package manager.</p>
<p>Alternatively, see the below section for quickstart instructions using the conda package manager (part of <a href="https://docs.conda.io/en/latest/miniconda.html">miniconda</a> or <a href="https://www.anaconda.com/products/individual">Anaconda</a>) on Linux or macOS.</p>
<h2><a class="anchor" id="Provisioning"></a>
Scripts</h2>
<p>Under <code>mxlib/scripts</code> there are scripts which will setup your system to build and use <code>mxlib</code>. For instance <code>mxlib/scripts/mxlib_provision_ubuntu2404.sh</code> will install dependencies and build and install mxlib for Ubuntu 24.04.</p>
<p>There is also a script to setup a multipass virtual machine, with a cloned <code>mxlib</code> repo. You can then run the provisioning script in the VM instance, after which you will have a working <code>mxlib</code> library installation.</p>
<h2><a class="anchor" id="install_depends"></a>
Dependencies</h2>
<p>This is the list of the other libraries that <code>mxlib</code> depends on. I usually install these from scratch to ensure maximum optimization (though I have little to no quantitative evidence that it matters), but you can probably manage most of these from the O/S package manager. You will need to make sure to install the <code>dev</code> packages.</p>
<ol type="1">
<li>You need a basic build system:<ol type="a">
<li>You need a c compiler supporting C99.</li>
<li>You need a c++17 compatible c++ compiler. c++20 is preferred and is the default.</li>
<li>You need <code>make</code></li>
<li>To use the <code>cmake</code> build system you need <code>cmake</code> and <code>pkg-config</code></li>
</ol>
</li>
<li>You need the <code>boost</code> c++ system library (this is probably obtainable from the linux distro package manager, fine to install with apt or yum).<ul>
<li>On Ubuntu you can just install <code>libboost-system-dev</code>.</li>
</ul>
</li>
<li>You need the <code>Eigen</code> matrix library (<a href="http://eigen.tuxfamily.org/index.php">http://eigen.tuxfamily.org/index.php</a>).<ul>
<li>It is best to use <code>cmake</code> to configure Eigen and install it. This will ensure that the package config is updated.</li>
</ul>
</li>
<li>You need the <a href="https://www.gnu.org/software/gsl/">GNU Scientific Library (GSL)</a> (this is probably obtainable from the linux distro package manager, but I recommend building yourself)</li>
<li>You need the <a href="http://heasarc.gsfc.nasa.gov/fitsio/">cfitsio </a> FITS library.</li>
<li>You need a BLAS and Lapack.<ul>
<li>openblas: widely supported and should be available via package manager. Also easy to build yourself.</li>
<li>MKL: the intel Math Kernel Library (MKL) is probably the highest performance option for Intel CPUs. It is free (as-in-beer) and straightforward to install. See my notes on <a class="el" href="group__mkl.html">installing MKL</a>.</li>
<li>ATLAS: Another option is ATLAS, see my notes on <a class="el" href="group__atlas.html">installing ATLAS</a>.</li>
</ul>
</li>
<li>You need <a class="el" href="group__fftw.html">the FFTW library, with at least version 3.3.5</a>.</li>
<li>Optional: CUDA toolkit</li>
<li>Optional: ImageStreamIO from the milk library.</li>
</ol>
<p>The relevant header files for each library need to be accessible to the compiler, either in a standard location or in one you specify when compiling your programs.</p>
<h2><a class="anchor" id="conda_install"></a>
Installing Dependencies From Conda</h2>
<p>The conda package manager contains packages for all of mxlib's external dependencies (not including vendored libraries, shipped under source/vendor/). This means setting up a correct build environment on macOS or Linux &ndash; even in a cluster environment, where you may not have root access &ndash; is straightforward. (To do: CUDA support with conda.)</p>
<p>Once you have installed conda (either <a href="https://docs.conda.io/en/latest/miniconda.html">miniconda</a> or <a href="https://www.anaconda.com/products/individual">Anaconda</a> is fine), you will create and activate an environment to use <code>mxlib</code> with. </p><div class="fragment"><div class="line">$ conda create -y -n mxlib_env</div>
</div><!-- fragment --><p> The install process is tested with conda-forge packages, which you may not be using by default. (Installing them in the mxlib_env environment won't cause conflicts with any other environments you may have.) </p><div class="fragment"><div class="line">$ conda activate mxlib_env</div>
<div class="line">$ bash ./setup/conda_env_setup_Linux.bash</div>
<div class="line"><span class="preprocessor"># or, on macOS:</span></div>
<div class="line">$ bash ./setup/conda_env_setup_macOS.bash</div>
</div><!-- fragment --><p> You may see the message: "To make your changes take effect please reactivate your environment." That would be "conda deactivate" followed by "conda activate mxlib_env".</p>
<p>If all went well, you should now be able to build <code>mxlib</code> with <code>cmake</code> like so:</p>
<div class="fragment"><div class="line">mkdir _build</div>
<div class="line">cd _build</div>
<div class="line">cmake -DCMAKE_INSTALL_PREFIX=$CONDA_PREFIX ..</div>
<div class="line">make</div>
<div class="line">sudo make install</div>
</div><!-- fragment --><h1><a class="anchor" id="cmake_build"></a>
Configuring mxlib with cmake</h1>
<p>The <code>cmake</code> build system will (in most cases) automatically configure mxlib for you, and install it along with a <code>pkg-config</code> and a <code>cmake</code> configuration file to asssist with linking to <code>mxlib</code>. The above <a class="el" href="group__installation.html#quick_start">Quick Start</a> section gives the basic recipe for building mxlib.</p>
<p>If you want or need to modify things, <code>cmake</code> has many options and <code>mxlib</code> adds its own. You can use them like </p><div class="fragment"><div class="line">cmake -DMXLIB_OPTION_NAME=val ..</div>
</div><!-- fragment --><h2><a class="anchor" id="cmake_gen_options"></a>
Useful cmake options</h2>
<table class="doxtable">
<caption>cmake options for mxlib</caption>
<tr>
<th>option </th><th>type </th><th>default </th><th>description </th></tr>
<tr>
<td>CMAKE_INSTALL_PREFIX </td><td>string </td><td>/usr/local </td><td>destination for lib/mxlib.so and include/mx </td></tr>
</table>
<h2><a class="anchor" id="cmake_mxlib_options"></a>
cmake Options for mxlib</h2>
<p>You may wish to change some of the settings or compile without some of the dependencies. To table below lists the <code>mxlib</code> specific options that can be passed to <code>cmake</code> .</p>
<table class="doxtable">
<caption>cmake options for mxlib</caption>
<tr>
<th>option </th><th>type </th><th>default </th><th>description </th></tr>
<tr>
<td>MXLIB_CVERSION </td><td>string </td><td>&ndash;std=c99 </td><td>mxlib c version </td></tr>
<tr>
<td>MXLIB_CXXVERSION </td><td>string </td><td>&ndash;std=c++20 </td><td>mxlib c++ version (minimum is c++17) </td></tr>
<tr>
<td>MXLIB_CFLAGS </td><td>string </td><td>-march=native -mfma -DNDEBUG </td><td>mxlib c compiler flags </td></tr>
<tr>
<td>MXLIB_CXXFLAGS </td><td>string </td><td>-march=native -mfma -DNDEBUG </td><td>mxlib c++ compiler flags </td></tr>
<tr>
<td>MXLIB_OPTIMIZE </td><td>string </td><td>-O3 &ndash;fast-math </td><td>mxlib optimization settings </td></tr>
<tr>
<td>MXLIB_DEFINES </td><td>string </td><td>-D_XOPEN_SOURCE=700 </td><td>mxlib compiler command line defines </td></tr>
<tr>
<td>MXLIB_USE_OPENMP </td><td>bool </td><td>ON </td><td>Whether or not to use OpenMP in <code>mxlib</code> and other libraries </td></tr>
<tr>
<td>MXLIB_USE_CUDA </td><td>bool </td><td>ON </td><td>Whether or not to use CUDA library for mxlib </td></tr>
<tr>
<td>MXLIB_USE_ISIO </td><td>bool </td><td>ON </td><td>Whether or not to use the ImageStreamIO library for mxlib </td></tr>
<tr>
<td>MXLIB_USE_FFT_FROM </td><td>string </td><td>fftw </td><td>Which library to use for the FFT interface in mxlib </td></tr>
<tr>
<td>MXLIB_USE_BLAS_FROM </td><td>string </td><td>openblas </td><td>Which library to use for BLAS and Lapack in mxlib. Supported choicess: mkl, openblas. </td></tr>
</table>
<h2><a class="anchor" id="blas_config"></a>
Configuring BLAS</h2>
<h3><a class="anchor" id="mkl_config"></a>
Configuring MKL</h3>
<p>Even though <code>cmake</code> includes a package-finder for MKL, it doesn't work the way we need it to for mxlib. So the following options allow for manual configuration of <code>mxlib</code> for MKL.</p>
<table class="doxtable">
<caption>cmake options for mkl in mxlib</caption>
<tr>
<th>option </th><th>type </th><th>default </th><th>description </th></tr>
<tr>
<td>MXLIB_MKL_INCLUDE_DIRECTORY </td><td>string </td><td>$ENV{MKLROOT}/include </td><td>MKL include directory </td></tr>
<tr>
<td>MXLIB_MKL_DEFINITIONS </td><td>string </td><td>-DMXLIB_MKL </td><td>MKL compiler defines </td></tr>
<tr>
<td>MXLIB_MKL_CFLAGS </td><td>string </td><td>-m64 </td><td>MKL compiler c-flags (used for cxx too) </td></tr>
<tr>
<td>MXLIB_MKL_LIBDIRS </td><td>list </td><td>$ENV{MKLROOT}/lib/intel64 </td><td>MKL link directories </td></tr>
<tr>
<td>MXLIB_MKL_LDFLAGS </td><td>string </td><td>-Wl,&ndash;no-as-needed </td><td>MKL link flags </td></tr>
<tr>
<td>MXLIB_MKL_LIBS </td><td>list </td><td>mkl_intel_lp64;mkl_sequential;mkl_core;pthread;m;dl </td><td>MKL libraries </td></tr>
</table>
<h1><a class="anchor" id="build_environment"></a>
Using mxlib</h1>
<h1><a class="anchor" id="git_tracking"></a>
Git Version Tracking</h1>
<p>Mxlib includes a system to track its git version, using the SHA1 hash. This, in principle, allows any results to be tagged with the version of the library used to generate them. The goal is to always be able to restore the code to a given point so that previous results can be reproduced. The library will issue a warning at compile time if there are any modifications to it that aren't yet committed, meaning that they aren't trackable.</p>
<h2><a class="anchor" id="linking"></a>
Linking to mxlib</h2>
<p>Once <code>mxlib</code> is built and installed, set the <code>$MXMAKEFILE</code> variable in your shell (and/or shell profile files):</p>
<div class="fragment"><div class="line"><span class="keyword">export</span> MXMAKEFILE=/path/to/mxlib/mk/MxApp-cmake.mk</div>
</div><!-- fragment --><p>You can then build a single .cpp program, let's say "myProgram.cpp", with the following line </p><div class="fragment"><div class="line">make -B -f $MXMAKEFILE t=myProgram</div>
</div><!-- fragment --><p>Note that tab-complete usually works, so you type <code>make -B -f $MX&lt;tab&gt;</code> and the shell should work for you.</p>
<p>Now to install the program, you need to give <code>make</code> a hint about what is to be installed. The command is </p><div class="fragment"><div class="line">make -f $MXMAKEFILE TARGET=myProgram install</div>
</div><!-- fragment --><p>This installs the <code>myProgram</code> binary to <code>$PREFIX/bin</code>.</p>
<p>For more complicated applications, you can create a local <code>Makefile</code> which specifies the <code>TARGET</code> and additional objects with <code>OTHER_OBJS</code>, and finally includes <code>MxApp.mk</code>. See <code>MxApp.mk</code> for additional options.</p>
<h1><a class="anchor" id="The"></a>
Old Makefile Build System</h1>
<p>Configuring the old makefile build system requires editing files in the <code>mxlib/local</code> directory. To avoid getting the modification warning due to makefile modifications, the only files you should edit during installation are the local/Common.mk, local/MxLib.mk, and local/mxApp.mk. Do not edit these in the mk folder.</p>
<h2><a class="anchor" id="building_make"></a>
Configuring and Building mxlib</h2>
<p>Once you have met all the dependencies:</p>
<ol type="1">
<li>clone <code>mxlib</code> from <a href="https://github.com/jaredmales/mxlib">https://github.com/jaredmales/mxlib</a></li>
<li>If you need to customize the build (e.g. switch the BLAS or FFT library used or modify paths), run <code>make setup</code>. This will create three Makefiles in <code>local/</code> for you to customize.</li>
<li>To further configure <code>mxlib</code> edit the files in the <code>local/</code> directory only. Some options are:<ul>
<li>Any variable set with <code>?=</code> in the files in <code>mk/</code> can be overridden in the corresponding <code>local/</code> one. The files in <code>local/</code> are not tracked in git and editing them will not cause compile warnings.</li>
<li>If you want to change the install path from <code>$HOME</code> to something else, set <code>PREFIX=</code> in <code>local/Common.mk</code>.</li>
<li><code>USE_BLAS_FROM</code> can be set to <code>mkl</code>, <code>ATLAS</code>, or <code>Accelerate</code> (macOS only). You may also need to override <code>BLAS_INCLUDES</code>, <code>BLAS_LDFLAGS</code>, and/or <code>BLAS_LDLIBS</code> to set paths and flags. (See <code>mk/MxApp.mk</code> for examples.)</li>
</ul>
</li>
<li>You can also pass config options to make, as in <code>make PREFIX=/path/to/libs</code>.</li>
<li>Build <code>mxlib</code> by running <code>make</code> at the top level.</li>
<li>Install <code>mxlib</code> with <code>make install</code>. <code>sudo</code> may be required depending on the <code>PREFIX</code>. Possibly <code>sudo -E</code>.</li>
</ol>
<h2><a class="anchor" id="building_make_conda"></a>
Makefile build with Conda</h2>
<p>If you have used <code>conda</code> to install the dependencies you should set <code>PREFIX=$CONDA_PREFIX</code> and <code>NEED_CUDA=no</code>. It is recommended that you do this in <code>local/Common.mk</code> but it can be done on the command line as:</p>
<div class="fragment"><div class="line">make install PREFIX=$CONDA_PREFIX NEED_CUDA=no</div>
</div><!-- fragment --><p>Now <code>mxlib</code> headers and libraries are in $CONDA_PREFIX/include and $CONDA_PREFIX/lib and should be found by default as long as "conda activate mxlib_env" is always run after you open a new terminal and before you compile things that use mxlib. </p>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Aug 8 2025 12:42:19 for mxlib by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
